<%# CONTAINER %>
<div class="p-6 flex flex-col items-center" data-controller="recording">
  <div></div>

  <%# TRIP BANNER %>
  <div class="w-full bg-white rounded-xl shadow-sm p-4 mb-8 flex items-center gap-4">
    <%# Country Image or Flag %>
    <%= image_tag "https://miro.medium.com/0*lm35oJDt_4ZS11tT.jpeg", class: "w-14 h-14 rounded-lg object-cover" %>

    <div class="flex-1">
      <h2 class="text-lg font-semibold text-[#06231B]">
        <%= @trip.country %>
      </h2>

      <p class="text-sm text-[#06231B]/60">
        22nd November to 30th November
      </p>

      <p class="text-sm text-[#06231B]/60 mt-1">
        Total spent: <span class="font-semibold text-[#06231B]">€1000</span>
      </p>
    </div>
  </div>


  <%# MAIN ACTION CTA — MIC BUTTON IN CENTER %>
  <div class="flex flex-col items-center mt-4">

    <button type="button"
      id="start-recording"
      class="w-28 h-28 bg-[#21A179] text-white rounded-full shadow-lg flex items-center justify-center transition active:scale-95"
      data-recording-target="startRecording"
      data-action="click->recording#start">
      <i data-lucide="mic" class="w-10 h-10"></i>
    </button>

    <p class="text-sm text-[#06231B]/70 mt-4">
      Tap to start recording
    </p>
  </div>


  <%# STOP BUTTON (hidden until recording) %>
  <button type="button"
    id="stop-recording"
    class="mt-6 w-40 bg-gray-400 text-white py-2 rounded-full hidden"
    data-recording-target="stopRecording"
    data-action="click->recording#stop"
    disabled>
    Stop & Save
  </button>


  <%# RECORDING STATUS %>
  <div id="recording-status"
    class="mt-4 text-[#06231B]/80 text-sm hidden flex items-center gap-2"
    aria-live="polite"
    data-recording-target="recordingStatus">

    <span id="recording-dot"
      class="w-3 h-3 rounded-full bg-red-600 animate-pulse hidden"
      data-recording-target="recordingDot">
    </span>

    <span id="recording-message" data-recording-target="recordingMessage"></span>
  </div>


  <%# HIDDEN FIELDS %>
  <%= form_with model: [@trip, @expense], 
    data: { recording_target: "form" }, 
    id: "recording-form", 
    local: true, 
    html: { multipart: true } do |f| %>

    <%= f.hidden_field :trip_id, value: @trip.id %>

    <%= f.file_field :audio,
      id: "expense_audio",
      data: { recording_target: "fileInput" },
      accept: "audio/*",
      class: "hidden" %>

  <% end %>

</div>
